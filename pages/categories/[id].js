import { fetchPosts } from "../../components/GetFiles";
import styles from "../../styles/Classes.module.css";
import Head from "next/head";
import Link from "next/link";
import listStyles from "../../styles/List.module.css";
import { fetchCategories } from "../../components/GetCategories";

export const getStaticPaths = async () => {
  const data = await fetchPosts();
  if (data) {
    const paths = data?.data?.data?.map((unit, idx) => ({
      params: { id: unit?.category || idx },
    }));
  }

  return {
    paths,
    fallback: false,
  };
};

export const getStaticProps = async (context) => {
  const classesData = await fetchPosts(false, context?.params?.id);
  const categoryData = await fetchCategories(classesData?.data?.data?.category);

  const category = categoryData?.data?.data;

  return {
    props: { classes: classesData?.data?.data, category },
  };
};

const Classes = ({ classes, category }) => {
  //const [classes, setClasses] = useState(null);
  return (
    <div className={styles.masterContainer}>
      <Head>
        <title>Aulas</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <h1 className={`${styles.centerText}`}>{category[0]?.title}</h1>
      <h1 className={`${styles.centerText}`}>Aulas</h1>
      <p className={`${styles.centerText}`}>Escolha a aula desejada</p>
      <div className={listStyles.listContainer}>
        {classes.map((unit) => (
          <Link href={`/classes/${unit._id}`} key={unit._id}>
            <div className={listStyles.card}>
              <h1 className={listStyles.mr2}>{unit.title}</h1>
              <p>{unit.description}</p>
            </div>
          </Link>
        ))}
      </div>
    </div>
  );
};

export default Classes;
